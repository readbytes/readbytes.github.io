<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>JavaScript Canvas Programming User Interaction and Event Handling</title>
<link rel='shortcut icon' href='https://java2s.com/style/favicon.ico'>
<link href="https://fonts.googleapis.com/css2?family=Merriweather&display=swap" rel="stylesheet" />
<link href="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/themes/prism-tomorrow.min.css" rel="stylesheet" />

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/codemirror.min.css" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/theme/material.css"> <!-- Dark theme -->
<script src="https://cdn.jsdelivr.net/npm/typescript@5/lib/typescript.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/codemirror.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/mode/htmlmixed/htmlmixed.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/mode/xml/xml.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/mode/css/css.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/mode/javascript/javascript.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/mode/javascript/typescript.min.js"></script>
<style>
    #floatingLog {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: rgba(20, 20, 20, 0.95);
      color: white;
      font-family: monospace;
      font-size: 14px;
      padding: 16px 20px;
      border-radius: 8px;
      box-shadow: 0 4px 16px rgba(0, 0, 0, 0.4);
      max-width: 80%;
      max-height: 200px;
      overflow-y: auto;
      display: none;
      z-index: 9999;
      pointer-events: none;
      white-space: pre-wrap;
      text-align: center;
    }
</style>
<script>
  const codeMirrorMap = new Map();
  const iframeMap = new Map();
  
 

  let dismissTimer;
  function showFloatingLog(message) {
	const floatingLog = document.getElementById('floatingLog');

    if (floatingLog.style.display !== 'block') {
      floatingLog.textContent = '';
      floatingLog.style.display = 'block'; 
    }

    floatingLog.textContent += message + '\n';
    floatingLog.scrollTop = floatingLog.scrollHeight; 
    clearTimeout(dismissTimer);
    dismissTimer = setTimeout(() => {
      floatingLog.style.display = 'none';
      floatingLog.textContent = '';
    }, 2000);
  }
  window.addEventListener('message', (event) => {
	    if (!iframeMap.has(event.source)) return;

	    if (event.data?.type === 'console-log') {
	      showFloatingLog(event.data.message);
	    }
  });  
  function renderIframe(button,textarea_id, iframe_id) {
      const html = codeMirrorMap.get(textarea_id).getValue();
      const iframe = document.getElementById(iframe_id);
  
      const oldIframe = iframe;
      const newIframe = document.createElement('iframe');
      newIframe.className ="result_iframe";
      
      newIframe.id = iframe_id;
      oldIframe.replaceWith(newIframe);
 

      // Track the iframe in the map
      iframeMap.set(newIframe.contentWindow, button);

      const overrideScript = `
        <script>
          (function() {
            const originalLog = console.log;
            console.log = function(...args) {
              originalLog.apply(console, args);
              window.parent.postMessage({
                type: 'console-log',
                message: args.map(a => {
                  try { return JSON.stringify(a); }
                  catch { return String(a); }
                }).join(' ')
              }, '*');
            };
          })();
        <\/script>
      `;

      const iframeHTML = `
        <!DOCTYPE html>
        <html>
        <body>
          ${overrideScript}
          ${html}
        </body>
        </html>
      `;
 
      const doc = newIframe.contentDocument || newIframe.contentWindow.document;
      doc.open();
      doc.write(iframeHTML);
      doc.close();

      
      setTimeout(() => {
    	  newIframe.style.height = '0px';
    	   let contentHeight = Math.max(doc.body.scrollHeight,doc.documentElement.scrollHeight);
 
    	   if(contentHeight < 150 || contentHeight > 600){
    		   contentHeight = 600;
    	   } 
    	   newIframe.style.height = contentHeight + 'px';
    	}, 50);      
      
  }
  function renderIframeForClientTypescript(textarea_id, iframe_id) {
      let code = codeMirrorMap.get(textarea_id).getValue();
      code = ts.transpile(code);
      const iframe = document.getElementById(iframe_id);
      const doc = iframe.contentDocument || iframe.contentWindow.document;

const html = `
  <!DOCTYPE html>
  <html>
    <head>
      <title>Output</title>
      <style>
        body { font-family: monospace; padding: 1em; background: #f4f4f4; color: #222; }
        pre { white-space: pre-wrap; word-break: break-word; }
        .error { color: red; }
      </style>
    </head>
    <body>
      <pre id="log"></pre>
      <script>
        (function(){
          const logEl = document.getElementById('log');
          const origLog = console.log;
          const origError = console.error;

          console.log = (...args) => {
            logEl.textContent += args.join(' ') + '\\n';
            origLog.apply(console, args);
          };
          console.table = (...args) => {
            logEl.textContent += args.join(' ') + '\\n';
            origLog.apply(console, args);
          };

          console.error = (...args) => {
            logEl.innerHTML +='<span class="error">' + args.join(' ') + '</span>';
            origError.apply(console, args);
          };
          window.addEventListener("error", function (event) {
              console.error("Caught by event listener:", event.message);
          });    
          try {             
              ${code};
          } catch (err) {
            console.error(err.stack || err.message);
          }
        })();
      <\/script>
    </body>
  </html>
`;

      iframe.style.display = "block";
      iframe.srcdoc = html;  
  }

    function renderIframeForClientJavascript(textarea_id, iframe_id) {
        const code = codeMirrorMap.get(textarea_id).getValue();
        const iframe = document.getElementById(iframe_id);
        const doc = iframe.contentDocument || iframe.contentWindow.document;

  const html = `
    <!DOCTYPE html>
    <html>
      <head>
        <title>Output</title>
        <style>
          body { font-family: monospace; padding: 1em; background: #1e1e1e; color: #eee; }
          pre { white-space: pre-wrap; word-break: break-word; }
          .error { color: red; }
        </style>
      </head>
      <body>
        <pre id="log"></pre>
        <script>
          (function(){
            const logEl = document.getElementById('log');
            const origLog = console.log;
            const origError = console.error;

            console.log = (...args) => {
              logEl.textContent += args.join(' ') + '\\n';
              origLog.apply(console, args);
            };
            console.table = (...args) => {
              logEl.textContent += args.join(' ') + '\\n';
              origLog.apply(console, args);
            };

            console.error = (...args) => {
              logEl.innerHTML +='<span class="error">' + args.join(' ') + '</span>';
              origError.apply(console, args);
            };
            window.addEventListener("error", function (event) {
                console.error("Caught by event listener:", event.message);
            });    
            try {
             ${code}; 
            } catch (err) {
              console.error(err.stack || err.message);
            }
          })();
        <\/script>
      </body>
    </html>
  `;
        iframe.style.display = "block";
        iframe.srcdoc = html;  
    }
    function toggleSnippetAndRefresh(id, textarea_id) {
      const box = document.getElementById(id);
      box.classList.toggle("open");
      codeMirrorMap.get(textarea_id).refresh();
    }

  </script>
  <script>
  const mode = localStorage.getItem('mode') || 'light';
  document.documentElement.classList.add(`${mode}-mode`);
  </script>   
<style> 
html {
  scroll-behavior: smooth;
}

body {
  font-family: 'Merriweather', serif;
  margin: 0;
  padding: 2rem 1rem;
  font-size: 15px;
  line-height: 1.5;
  transition: background-color 0.3s, color 0.3s;
}

.container {
  max-width: 700px;
  margin: 0 auto;
  padding: 1rem 2rem;
  box-shadow: 0 0 15px rgba(0,0,0,0.1);
}

h1, h2, h3 {
  font-weight: 600;
  margin-top: 2.5rem;
  margin-bottom: 1rem;
  line-height: 1.2;
}

h1 { font-size: 1.8rem; }
h2 { font-size: 1.4rem; }
h3 { font-size: 1.2rem; }

table {
  width: 100%;
  border-collapse: collapse;
  font-family: sans-serif;
  font-size: 1em;
  margin: 1em 0;
}

th, td {
  padding: 0.6em 1em;
  text-align: left;
  border: 1px solid;
}

tr:nth-child(even) {
  background-color: inherit;
}

tr:hover {
  background-color: inherit;
}

a {
  text-decoration: none;
  transition: color 0.2s;
}

a:hover {
  text-decoration: underline;
}

code {
  color: #d35400;
}

.book-title-chapter {
  font-family: 'Merriweather', serif;
  font-size: 2rem;
  font-weight: bold;
  text-align: center;
  margin-bottom: 2rem;
  border-bottom: 2px solid;
  padding-bottom: 0.5rem;
}

.book-subtitle-chapter {
  text-align: center;
  font-size: 1rem;
  margin-top: -1rem;
  margin-bottom: 2rem;
}

.related-books {
  margin-top: 40px;
}

.related-book-list {
  display: flex;
  flex-wrap: wrap;
  gap: 20px;
}

    .book-cover {
      width: 130px;
      height: 180px;
      font-family: Arial, sans-serif;
      position: relative;
      overflow: hidden;      
      line-height: normal;
      box-shadow: 2px 2px 4px rgba(0,0,0,0.1);
    }
    .book-cover-bottom-stripe {
      position: absolute;
      bottom: 0;
      left: 0;
      height: 5px;
      width: 100%;
    }
    .book-cover-title {
      position: absolute;
      width: 100%;
      text-align: center;
      font-weight: bold;
    }
     
    .book-cover-icon {
      position: absolute;
      left: 50%;
      transform: translateX(-50%);
      display: flex;
      align-items: center;
      justify-content: center; 
    }

    .book-cover-author {
      position: absolute;
      bottom: 10px;
      width: 100%;
      text-align: center;
      font-size: 8px;
      color: #333;
    }

.page-footer {
  margin-top: 4rem;
  padding: 1rem 0;
  text-align: center;
  font-size: 0.85rem;
  border-top: 1px solid;
}

.chapter-navi-section {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding-bottom: 10px;
}

.nav-link {
  color: inherit;
  text-decoration: none;
  opacity: 0.5;
  transition: opacity 0.3s ease, text-decoration 0.3s ease;
}

.nav-link:hover {
  opacity: 0.9;
  text-decoration: underline;
}

.prev { text-align: left; }
.toc-link { text-align: center; }
.next { text-align: right; }

.download-section {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 2rem;
  padding: 2rem 1rem;
  max-width: 600px;
  margin: 3rem auto;
  border-radius: 12px;
  box-shadow: 0 4px 10px rgba(0,0,0,0.05);
}

.download-info h2 {
  margin: 0 0 0.5rem;
  font-size: 1.2rem;
}

.format-label {
  margin: 0 0 0.5rem;
  font-size: 0.95rem;
}

.download-buttons {
  display: flex;
  gap: 1rem;
}

.download-button {
  background-color: #4A90E2;
  color: white;
  padding: 0.5em 1.2em;
  border-radius: 25px;
  font-size: 0.95rem;
  text-decoration: none;
  transition: background-color 0.3s ease;
}

.download-button:hover {
  background-color: #357ABD;
}

.code-block {
  position: relative;
  margin-bottom: 1em;
}

.copy-button {
  background: transparent;
  color: white;
  position: absolute;
  top: 8px;
  right: 8px;
  border: none;
  padding: 4px 8px;
  font-size: 12px;
  border-radius: 4px;
  cursor: pointer;
  z-index: 1;
}

.copy-button:hover {
  background-color: #0056b3;
}

.snippet-container {
  overflow: hidden;
}

.snippet-header {
  padding: 0.75rem 1rem;
  cursor: pointer;
  font-size: 1rem;
    background-color: #eeeeee;
    color:  #111111; 
    border-radius: 8px;
    cursor: pointer;
    box-shadow: 0 4px 6px rgba(0,0,0,0.1);  
}

.snippet-body {
  display: none;
  font-family: monospace;
}

.snippet-container.open .snippet-body {
  display: block;
}

.CodeMirror {
  border: 2px solid #ccc;
  border-radius: 4px;
  resize: vertical;
}

/* === Light Mode === */
html.light-mode {
  background-color: #f8f7f5;
  color: #333;
}

html.light-mode .container {
  background: white;
}

html.light-mode .book-title-chapter {
  color: #2c3e50;
  border-color: #ccc;
}
html.light-mode .book-subtitle-chapter{
  color: #888;
}

html.light-mode .page-footer,
html.light-mode .series-name,
html.light-mode .book-subtitle,
html.light-mode .format-label {
  color: #888;
}

html.light-mode .related-books h2 {
  color: #333;
  border-bottom: 2px solid #eee;
}

html.light-mode .book-title {
  color: #fff;
}

html.light-mode .book-cover {
  border: 1px solid #ccc;
}

html.light-mode th {
  background-color: #f2f2f2;
}

html.light-mode tr:nth-child(even) {
  background-color: #fafafa;
}

html.light-mode tr:hover {
  background-color: #e6f7ff;
}

html.light-mode a,
html.light-mode .page-footer a {
  color: #000;
}

/* === Dark Mode === */
html.dark-mode {
  background-color: #181818;
  color: #e0e0e0;
}

html.dark-mode .container {
  background: #222;
}

html.dark-mode .book-title-chapter {
  color: #ddd;
  border-color: #444;
}

html.dark-mode .snippet-header {
    background-color: #333;
    color:  #ddd; 
}


html.dark-mode .book-subtitle-chapter,
html.dark-mode .page-footer,
html.dark-mode .series-name,
html.dark-mode .book-subtitle,
html.dark-mode .book-footer,
html.dark-mode .format-label {
  color: #aaa;
}

html.dark-mode .related-books h2 {
  color: #ddd;
  border-bottom: 2px solid #333;
}

html.dark-mode .book-title {
  color: #fff;
}

html.dark-mode .book-cover {
  border: 1px solid #555;
}

html.dark-mode th {
  background-color: #333;
  color: #fff;
}

html.dark-mode td {
  border-color: #444;
}

html.dark-mode tr:nth-child(even) {
  background-color: #2a2a2a;
}

html.dark-mode tr:hover {
  background-color: #2c3e50;
}

html.dark-mode a,
html.dark-mode .page-footer a {
  color: #eee;
}

    .dialog-backdrop {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      background: rgba(0,0,0,0.5);
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 10;
    }

    .dialog {
      background: white;
      padding: 20px;
      width: 90vw;
      height: 80vh;
      border-radius: 8px;
      box-shadow: 0 0 20px rgba(0,0,0,0.3);
      display: flex;
      flex-direction: column;
    }
    .dialog-content {
      display: flex;
      flex: 1;
      gap: 20px;
      margin-top: 10px;
    }
    .dialog h2 {
      margin-top: 0;
    }

    .textarea_dialog {
      width: 50%;
      height: 100%;
      resize: none;
      font-family: monospace;
      font-size: 14px;
      padding: 10px;
      box-sizing: border-box;
      border: 1px solid #ccc;
    }

    .iframe_dialog {
      width: 50%;
      height: 100%;
      border: 1px solid #ccc;
    }
    .controls_dialog {
      display: flex;
      justify-content: space-between;
      margin-top: 10px;
    }    
    button { padding: 0.5em 1em; background: green; color: white; border: none; cursor: pointer; }
    button:hover { background: #1e7e34; }
    .result_iframe { width:99%; height:200px; margin-top: 1em;  resize: both;border:1px solid #ccc;}        
</style>
</head>
<body> 
  <div class="container">
    <div class = "chapter-navi-section">
<a href="javascript-canvas-programming-advanced-animation-techniques.htm" class="nav-button prev">←</a>
<a href='javascript-canvas-programming.htm#user-interaction-and-event-handling' class="nav-button toc-link">Index</a>
<a href="javascript-canvas-programming-working-with-canvas-state-and-compositing.htm" class="nav-button next">→</a>
</div>

    <h1 class="book-title-chapter" id = 'top'>User Interaction and Event Handling</h1>
    <h3 class="book-subtitle-chapter">JavaScript Canvas Programming</h3>   
    <!-- <h1 class ="chapter-title"></h1> -->
    <h2 id='capturing-mouse-and-keyboard-events'>9.1 Capturing Mouse and Keyboard Events</h2><p>User interaction is key to building engaging and dynamic canvas applications. This section covers how to capture mouse and keyboard events, translate coordinates correctly, and use these inputs to control objects on the canvas.</p><h3 id="registering-event-listeners">Registering Event Listeners</h3><p>In JavaScript, the primary way to respond to user input is by <strong>registering event listeners</strong> with the <code>addEventListener()</code> method. You can attach listeners to the <code>&lt;canvas&gt;</code> element itself or to the <code>window</code> or <code>document</code> objects for keyboard events.</p><h3 id="common-events">Common Events</h3><table>
 <thead>
  <tr>
   <th>Event Type</th>
   <th>Description</th>
   <th>Typical Target</th>
  </tr>
 </thead>
 <tbody>
  <tr>
   <td><code>mousedown</code></td>
   <td>Mouse button pressed</td>
   <td>Canvas or Window</td>
  </tr>
  <tr>
   <td><code>mouseup</code></td>
   <td>Mouse button released</td>
   <td>Canvas or Window</td>
  </tr>
  <tr>
   <td><code>mousemove</code></td>
   <td>Mouse moved</td>
   <td>Canvas</td>
  </tr>
  <tr>
   <td><code>keydown</code></td>
   <td>Key pressed down</td>
   <td>Window or Document</td>
  </tr>
  <tr>
   <td><code>keyup</code></td>
   <td>Key released</td>
   <td>Window or Document</td>
  </tr>
 </tbody>
</table><h3 id="example-registering-mouse-events-on-canvas">Example: Registering Mouse Events on Canvas</h3><div class="code-block"><button class="copy-button" onclick="copyCode(this)">▯</button>
 <pre><code class="language-js">const canvas = document.getElementById('canvas');

canvas.addEventListener('mousedown', (event) =&gt; {
  console.log('Mouse down at', event.clientX, event.clientY);
});

canvas.addEventListener('mousemove', (event) =&gt; {
  console.log('Mouse moved at', event.clientX, event.clientY);
});</code></pre>
</div><h3 id="translating-mouse-coordinates-relative-to-canvas">Translating Mouse Coordinates Relative to Canvas</h3><p>Mouse event coordinates like <code>event.clientX</code> and <code>event.clientY</code> are relative to the <strong>viewport</strong> (the browser window), not the canvas itself. To get the mouse position <strong>inside the canvas</strong>, you must adjust for the canvas's position on the page.</p><h3 id="how-to-translate-coordinates">How to Translate Coordinates</h3><div class="code-block"><button class="copy-button" onclick="copyCode(this)">▯</button>
 <pre><code class="language-js">function getMousePos(canvas, event) {
  const rect = canvas.getBoundingClientRect(); // Get canvas position and size
  return {
    x: event.clientX - rect.left,
    y: event.clientY - rect.top
  };
}

canvas.addEventListener('mousedown', (event) =&gt; {
  const pos = getMousePos(canvas, event);
  console.log('Mouse position relative to canvas:', pos.x, pos.y);
});</code></pre>
</div><p>This calculation accounts for the canvas’s position, borders, and scrolling.</p><h3 id="capturing-keyboard-input">Capturing Keyboard Input</h3><p>Keyboard events are usually registered on the <code>window</code> or <code>document</code> object because the canvas does not automatically receive keyboard focus.</p><h3 id="example-using-keyboard-events-to-move-an-object">Example: Using Keyboard Events to Move an Object</h3><div class="code-block"><button class="copy-button" onclick="copyCode(this)">▯</button>
 <pre><code class="language-js">let x = 50;
let y = 50;

window.addEventListener('keydown', (event) =&gt; {
  switch(event.key) {
    case 'ArrowUp':
      y -= 10;
      break;
    case 'ArrowDown':
      y += 10;
      break;
    case 'ArrowLeft':
      x -= 10;
      break;
    case 'ArrowRight':
      x += 10;
      break;
  }
  console.log(`Object position: (${x}, ${y})`);
  // You can redraw your object at the new position here
});</code></pre>
</div><h3 id="ensuring-canvas-can-receive-keyboard-input">Ensuring Canvas Can Receive Keyboard Input</h3><p>If you need the canvas element to capture keyboard events directly, it needs to be <strong>focusable</strong>. You can make the canvas focusable by adding a <code>tabindex</code> attribute:</p><div class="code-block"><button class="copy-button" onclick="copyCode(this)">▯</button>
 <pre><code class="language-html">&lt;canvas id="canvas" width="400" height="300" tabindex="0"&gt;&lt;/canvas&gt;</code></pre>
</div><p>Then, you can add keyboard listeners to the canvas:</p><div class="code-block"><button class="copy-button" onclick="copyCode(this)">▯</button>
 <pre><code class="language-js">canvas.addEventListener('keydown', (event) =&gt; {
  console.log('Key pressed on canvas:', event.key);
});
canvas.focus(); // To set focus programmatically when needed</code></pre>
</div><h3 id="summary">Summary</h3><ul>
 <li>Use <code>addEventListener()</code> to listen for mouse and keyboard events.</li>
 <li>Translate mouse coordinates from viewport to canvas-relative coordinates for accurate interaction.</li>
 <li>Keyboard events are usually captured on <code>window</code> or <code>document</code> but can be directed to canvas with <code>tabindex</code>.</li>
 <li>Combine these event inputs to create interactive canvas applications controlled by mouse and keyboard.</li>
</ul><p>In the next section, we will see how to use these interactions to build an interactive drawing application!</p><div class = "chapter-navi-section">
<a href="#top" class="nav-button prev">↑</a>
<a href='javascript-canvas-programming.htm#user-interaction-and-event-handling' class="nav-button toc-link">Index</a>
<a href="#bottom" class="nav-button next">↓</a>
</div>
<h2 id='interactive-drawing-applications'>9.2 Interactive Drawing Applications</h2><h3 id="interactive-drawing-applications">Interactive Drawing Applications</h3><p>One of the most engaging uses of the HTML5 canvas is creating interactive drawing applications. In this section, we'll build a basic app that allows users to draw freehand lines by clicking and dragging the mouse. This example introduces core concepts like tracking mouse state, storing previous coordinates, and drawing paths dynamically.</p><h3 id="core-concepts-tracking-mouse-state-and-coordinates">Core Concepts: Tracking Mouse State and Coordinates</h3><p>To draw continuously as the user drags the mouse, you need to:</p><ul>
 <li>Track <strong>whether the user is currently drawing</strong> (a boolean flag like <code>isDrawing</code>).</li>
 <li>Store the <strong>previous mouse coordinates</strong> so you can draw a line segment from the last point to the current point.</li>
 <li>Update the canvas with new line segments as the mouse moves.</li>
</ul><h3 id="basic-drawing-application-example">Basic Drawing Application Example</h3><div class="code-block"><button class="copy-button" onclick="copyCode(this)">▯</button>
 <pre><code class="language-html">&lt;canvas id="canvas" width="600" height="400" style="border:1px solid #ccc;"&gt;&lt;/canvas&gt;</code></pre>
</div><div class="code-block"><button class="copy-button" onclick="copyCode(this)">▯</button>
 <pre><code class="language-js">const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');

let isDrawing = false;
let lastX = 0;
let lastY = 0;

// Mouse down - start drawing
canvas.addEventListener('mousedown', (e) =&gt; {
  const rect = canvas.getBoundingClientRect();
  lastX = e.clientX - rect.left;
  lastY = e.clientY - rect.top;
  isDrawing = true;
});

// Mouse move - draw if mouse is down
canvas.addEventListener('mousemove', (e) =&gt; {
  if (!isDrawing) return;

  const rect = canvas.getBoundingClientRect();
  const currentX = e.clientX - rect.left;
  const currentY = e.clientY - rect.top;

  ctx.beginPath();
  ctx.moveTo(lastX, lastY);      // Start from previous point
  ctx.lineTo(currentX, currentY); // Draw line to current point
  ctx.stroke();

  lastX = currentX; // Update last positions
  lastY = currentY;
});

// Mouse up or leave - stop drawing
canvas.addEventListener('mouseup', () =&gt; {
  isDrawing = false;
});
canvas.addEventListener('mouseout', () =&gt; {
  isDrawing = false;
});</code></pre>
</div><div class="snippet-container" id="42zh4">
 <div id="tOcGQ_Dialog" class="dialog-backdrop">
  <div class="dialog">
   <h2>Dialog 1</h2>
   <div class="controls"><button onclick="renderIframe(this,'RvgCZ_Textarea','tOcGQ_IFrame')">Run</button> <button onclick="closeAll()">Close</button>
   </div>
   <div class="dialog-content"><textarea id="RvgCZ_Textarea" class="textarea_dialog" placeholder="Type HTML here...">&lt;!DOCTYPE html&gt;
&lt;html lang="en"&gt;
&lt;head&gt;
  &lt;meta charset="UTF-8"&gt;
&lt;/head&gt;
&lt;body&gt;

&lt;canvas id="myCanvas" width="400" height="200" style="border:1px solid #ccc;"&gt;&lt;/canvas&gt;

&lt;script&gt;
  const canvas = document.getElementById("myCanvas");
  const ctx = canvas.getContext("2d");

let isDrawing = false;
let lastX = 0;
let lastY = 0;

// Mouse down - start drawing
canvas.addEventListener('mousedown', (e) =&gt; {
  const rect = canvas.getBoundingClientRect();
  lastX = e.clientX - rect.left;
  lastY = e.clientY - rect.top;
  isDrawing = true;
});

// Mouse move - draw if mouse is down
canvas.addEventListener('mousemove', (e) =&gt; {
  if (!isDrawing) return;

  const rect = canvas.getBoundingClientRect();
  const currentX = e.clientX - rect.left;
  const currentY = e.clientY - rect.top;

  ctx.beginPath();
  ctx.moveTo(lastX, lastY);      // Start from previous point
  ctx.lineTo(currentX, currentY); // Draw line to current point
  ctx.stroke();

  lastX = currentX; // Update last positions
  lastY = currentY;
});

// Mouse up or leave - stop drawing
canvas.addEventListener('mouseup', () =&gt; {
  isDrawing = false;
});
canvas.addEventListener('mouseout', () =&gt; {
  isDrawing = false;
});
&lt;/script&gt;

&lt;/body&gt;
&lt;/html&gt;</textarea> <iframe id="tOcGQ_IFrame" class="iframe_dialog"></iframe>
   </div>
  </div>
 </div>
 <div class="snippet-header" onclick="toggleSnippetAndRefresh('42zh4','RvgCZ')">
  Click to Try it <!--<span onclick="toggleSnippetAndRefresh('42zh4','RvgCZ')">Click
			to Try it</span> --> <!-- <span onclick="openDialog('tOcGQ_Dialog')">Dialog</span> -->
 </div>
 <div class="snippet-body"><textarea id="RvgCZ">&lt;!DOCTYPE html&gt;
&lt;html lang="en"&gt;
&lt;head&gt;
  &lt;meta charset="UTF-8"&gt;
&lt;/head&gt;
&lt;body&gt;

&lt;canvas id="myCanvas" width="400" height="200" style="border:1px solid #ccc;"&gt;&lt;/canvas&gt;

&lt;script&gt;
  const canvas = document.getElementById("myCanvas");
  const ctx = canvas.getContext("2d");

let isDrawing = false;
let lastX = 0;
let lastY = 0;

// Mouse down - start drawing
canvas.addEventListener('mousedown', (e) =&gt; {
  const rect = canvas.getBoundingClientRect();
  lastX = e.clientX - rect.left;
  lastY = e.clientY - rect.top;
  isDrawing = true;
});

// Mouse move - draw if mouse is down
canvas.addEventListener('mousemove', (e) =&gt; {
  if (!isDrawing) return;

  const rect = canvas.getBoundingClientRect();
  const currentX = e.clientX - rect.left;
  const currentY = e.clientY - rect.top;

  ctx.beginPath();
  ctx.moveTo(lastX, lastY);      // Start from previous point
  ctx.lineTo(currentX, currentY); // Draw line to current point
  ctx.stroke();

  lastX = currentX; // Update last positions
  lastY = currentY;
});

// Mouse up or leave - stop drawing
canvas.addEventListener('mouseup', () =&gt; {
  isDrawing = false;
});
canvas.addEventListener('mouseout', () =&gt; {
  isDrawing = false;
});
&lt;/script&gt;

&lt;/body&gt;
&lt;/html&gt;</textarea> <br> <button onclick="renderIframe(this,'RvgCZ','tOcGQ')">Run</button>
  <div id="tOcGQ_FloatingLog" class="floatingLog" aria-live="polite" role="alert"></div> <iframe id="tOcGQ" class="result_iframe" style="display: none;"></iframe>
  <script>
			{
				let editor = CodeMirror.fromTextArea(document
						.getElementById("RvgCZ"), {
					mode : "htmlmixed",
					lineNumbers : false,
					tabSize : 2
				});
			    const mode = localStorage.getItem("mode") || "light";  
			    const newTheme = mode === "dark" ? "material" : "default";
			    editor.setOption("theme", newTheme);
			    
				codeMirrorMap.set("RvgCZ", editor);

				let editor1 = CodeMirror.fromTextArea(document.getElementById("RvgCZ_Textarea"), {
					mode : "htmlmixed",
					lineNumbers : false,
					tabSize : 2
				});
			    editor1.setOption("theme", newTheme);				
				
				codeMirrorMap.set("RvgCZ_Textarea", editor1);
			}
		    function openDialog(id) {
		        closeAll();
		        document.getElementById(id).style.display = 'flex';
		        setTimeout(() => {
		        	 codeMirrorMap.get("RvgCZ_Textarea").refresh();
		        }, 100); // 100ms 
		      }

		      function closeAll() {
		        document.querySelectorAll('.dialog-backdrop').forEach(el => {
		          el.style.display = 'none';
		        });
		      }			
		</script>
 </div>
</div><h3 id="how-this-works">How This Works</h3><ul>
 <li><strong><code>mousedown</code> event:</strong> Starts the drawing process, captures the initial coordinates, and sets <code>isDrawing = true</code>.</li>
 <li><strong><code>mousemove</code> event:</strong> If <code>isDrawing</code> is true, draws a line segment from the last known point to the current mouse position.</li>
 <li><strong><code>mouseup</code> and <code>mouseout</code> events:</strong> End the drawing by setting <code>isDrawing</code> to false.</li>
</ul><h3 id="enhancements-to-explore">Enhancements to Explore</h3><p>This basic app can be expanded with many useful features:</p><ul>
 <li><strong>Color Pickers:</strong> Allow users to select stroke colors.</li>
 <li><strong>Stroke Width:</strong> Let users adjust line thickness dynamically with sliders.</li>
 <li><strong>Undo/Redo:</strong> Maintain a stack of canvas states or paths to enable undoing mistakes.</li>
 <li><strong>Shape Tools:</strong> Add buttons to draw rectangles, circles, or other shapes.</li>
 <li><strong>Save and Export:</strong> Save drawings as images or JSON data.</li>
</ul><h3 id="why-canvas-for-drawing">Why Canvas for Drawing?</h3><p>Unlike SVG or HTML elements which represent vector shapes and DOM nodes, canvas works with pixel-based rendering. This makes canvas ideal for:</p><ul>
 <li>High-performance freehand drawing.</li>
 <li>Complex pixel manipulation and image editing.</li>
 <li>Games and applications requiring fast, dynamic graphics updates.</li>
</ul><p>However, since canvas pixels are just bitmap data, shapes are not independently selectable after drawing, which is why state management or redrawing logic is important for interactive apps.</p><h3 id="summary">Summary</h3><p>This simple drawing app demonstrates:</p><ul>
 <li>Tracking mouse state to enable smooth drawing.</li>
 <li>Using canvas path methods to draw continuous lines.</li>
 <li>Translating mouse coordinates for accurate rendering on canvas.</li>
</ul><p>Try modifying the code to add color selection or brush sizes to make the app your own! In the next sections, we will look at drag-and-drop and more complex editing features.</p><div class = "chapter-navi-section">
<a href="#top" class="nav-button prev">↑</a>
<a href='javascript-canvas-programming.htm#user-interaction-and-event-handling' class="nav-button toc-link">Index</a>
<a href="#bottom" class="nav-button next">↓</a>
</div>
<h2 id='drag-and-drop-on-canvas'>9.3 Drag-and-Drop on Canvas</h2><p>Interactivity on the canvas goes beyond just drawing — you can also implement <strong>drag-and-drop functionality</strong> to move shapes or objects around dynamically. This section explains how to detect clicks inside shapes, track mouse movement, and update the positions of shapes as they are dragged.</p><h3 id="core-concepts-for-drag-and-drop">Core Concepts for Drag-and-Drop</h3><ul>
 <li><strong>Hit Detection:</strong> Determine if a mouse click is inside a shape. This often uses bounding boxes or geometric checks.</li>
 <li><strong>Tracking Drag State:</strong> Use flags like <code>isDragging</code> and track which shape is currently being moved.</li>
 <li><strong>Coordinate Tracking:</strong> Save the offset between the mouse position and the shape's origin to keep dragging smooth.</li>
 <li><strong>Updating Position:</strong> As the mouse moves, update the shape’s coordinates and redraw the canvas.</li>
</ul><h3 id="example-moving-rectangles-on-canvas">Example: Moving Rectangles on Canvas</h3><p>Let’s build a simple example where the user can drag rectangles around the canvas.</p><div class="code-block"><button class="copy-button" onclick="copyCode(this)">▯</button>
 <pre><code class="language-html">&lt;canvas id="canvas" width="600" height="400" style="border:1px solid #ccc;"&gt;&lt;/canvas&gt;</code></pre>
</div><div class="code-block"><button class="copy-button" onclick="copyCode(this)">▯</button>
 <pre><code class="language-js">const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');

const rectangles = [
  { x: 50, y: 60, width: 100, height: 80, color: 'tomato' },
  { x: 200, y: 150, width: 120, height: 90, color: 'steelblue' }
];

let isDragging = false;
let dragIndex = null;
let offsetX, offsetY;

// Draw all rectangles
function draw() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  rectangles.forEach(rect =&gt; {
    ctx.fillStyle = rect.color;
    ctx.fillRect(rect.x, rect.y, rect.width, rect.height);
  });
}

draw();

// Utility: Check if point is inside a rectangle
function isInsideRect(x, y, rect) {
  return x &gt;= rect.x &amp;&amp;
         x &lt;= rect.x + rect.width &amp;&amp;
         y &gt;= rect.y &amp;&amp;
         y &lt;= rect.y + rect.height;
}

// Mouse down: Check if clicking inside any rectangle to start dragging
canvas.addEventListener('mousedown', (e) =&gt; {
  const rect = canvas.getBoundingClientRect();
  const mouseX = e.clientX - rect.left;
  const mouseY = e.clientY - rect.top;

  for (let i = 0; i &lt; rectangles.length; i++) {
    if (isInsideRect(mouseX, mouseY, rectangles[i])) {
      isDragging = true;
      dragIndex = i;
      offsetX = mouseX - rectangles[i].x;
      offsetY = mouseY - rectangles[i].y;
      break;
    }
  }
});

// Mouse move: If dragging, update rectangle position and redraw
canvas.addEventListener('mousemove', (e) =&gt; {
  if (!isDragging) return;

  const rect = canvas.getBoundingClientRect();
  const mouseX = e.clientX - rect.left;
  const mouseY = e.clientY - rect.top;

  rectangles[dragIndex].x = mouseX - offsetX;
  rectangles[dragIndex].y = mouseY - offsetY;

  draw();
});

// Mouse up: Stop dragging
canvas.addEventListener('mouseup', () =&gt; {
  isDragging = false;
  dragIndex = null;
});

// Mouse leave: Cancel dragging if mouse leaves canvas
canvas.addEventListener('mouseout', () =&gt; {
  isDragging = false;
  dragIndex = null;
});</code></pre>
</div><div class="snippet-container" id="yLxPP">
 <div id="fVIcf_Dialog" class="dialog-backdrop">
  <div class="dialog">
   <h2>Dialog 1</h2>
   <div class="controls"><button onclick="renderIframe(this,'SBQkG_Textarea','fVIcf_IFrame')">Run</button> <button onclick="closeAll()">Close</button>
   </div>
   <div class="dialog-content"><textarea id="SBQkG_Textarea" class="textarea_dialog" placeholder="Type HTML here...">&lt;!DOCTYPE html&gt;
&lt;html lang="en"&gt;
&lt;head&gt;
  &lt;meta charset="UTF-8"&gt;
&lt;/head&gt;
&lt;body&gt;

&lt;canvas id="myCanvas" width="600" height="400" style="border:1px solid #ccc;"&gt;&lt;/canvas&gt;

&lt;script&gt;
  const canvas = document.getElementById("myCanvas");
  const ctx = canvas.getContext("2d");

const rectangles = [
  { x: 50, y: 60, width: 100, height: 80, color: 'tomato' },
  { x: 200, y: 150, width: 120, height: 90, color: 'steelblue' }
];

let isDragging = false;
let dragIndex = null;
let offsetX, offsetY;

// Draw all rectangles
function draw() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  rectangles.forEach(rect =&gt; {
    ctx.fillStyle = rect.color;
    ctx.fillRect(rect.x, rect.y, rect.width, rect.height);
  });
}

draw();

// Utility: Check if point is inside a rectangle
function isInsideRect(x, y, rect) {
  return x &gt;= rect.x &amp;&amp;
         x &lt;= rect.x + rect.width &amp;&amp;
         y &gt;= rect.y &amp;&amp;
         y &lt;= rect.y + rect.height;
}

// Mouse down: Check if clicking inside any rectangle to start dragging
canvas.addEventListener('mousedown', (e) =&gt; {
  const rect = canvas.getBoundingClientRect();
  const mouseX = e.clientX - rect.left;
  const mouseY = e.clientY - rect.top;

  for (let i = 0; i &lt; rectangles.length; i++) {
    if (isInsideRect(mouseX, mouseY, rectangles[i])) {
      isDragging = true;
      dragIndex = i;
      offsetX = mouseX - rectangles[i].x;
      offsetY = mouseY - rectangles[i].y;
      break;
    }
  }
});

// Mouse move: If dragging, update rectangle position and redraw
canvas.addEventListener('mousemove', (e) =&gt; {
  if (!isDragging) return;

  const rect = canvas.getBoundingClientRect();
  const mouseX = e.clientX - rect.left;
  const mouseY = e.clientY - rect.top;

  rectangles[dragIndex].x = mouseX - offsetX;
  rectangles[dragIndex].y = mouseY - offsetY;

  draw();
});

// Mouse up: Stop dragging
canvas.addEventListener('mouseup', () =&gt; {
  isDragging = false;
  dragIndex = null;
});

// Mouse leave: Cancel dragging if mouse leaves canvas
canvas.addEventListener('mouseout', () =&gt; {
  isDragging = false;
  dragIndex = null;
});
&lt;/script&gt;

&lt;/body&gt;
&lt;/html&gt;</textarea> <iframe id="fVIcf_IFrame" class="iframe_dialog"></iframe>
   </div>
  </div>
 </div>
 <div class="snippet-header" onclick="toggleSnippetAndRefresh('yLxPP','SBQkG')">
  Click to Try it <!--<span onclick="toggleSnippetAndRefresh('yLxPP','SBQkG')">Click
			to Try it</span> --> <!-- <span onclick="openDialog('fVIcf_Dialog')">Dialog</span> -->
 </div>
 <div class="snippet-body"><textarea id="SBQkG">&lt;!DOCTYPE html&gt;
&lt;html lang="en"&gt;
&lt;head&gt;
  &lt;meta charset="UTF-8"&gt;
&lt;/head&gt;
&lt;body&gt;

&lt;canvas id="myCanvas" width="600" height="400" style="border:1px solid #ccc;"&gt;&lt;/canvas&gt;

&lt;script&gt;
  const canvas = document.getElementById("myCanvas");
  const ctx = canvas.getContext("2d");

const rectangles = [
  { x: 50, y: 60, width: 100, height: 80, color: 'tomato' },
  { x: 200, y: 150, width: 120, height: 90, color: 'steelblue' }
];

let isDragging = false;
let dragIndex = null;
let offsetX, offsetY;

// Draw all rectangles
function draw() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  rectangles.forEach(rect =&gt; {
    ctx.fillStyle = rect.color;
    ctx.fillRect(rect.x, rect.y, rect.width, rect.height);
  });
}

draw();

// Utility: Check if point is inside a rectangle
function isInsideRect(x, y, rect) {
  return x &gt;= rect.x &amp;&amp;
         x &lt;= rect.x + rect.width &amp;&amp;
         y &gt;= rect.y &amp;&amp;
         y &lt;= rect.y + rect.height;
}

// Mouse down: Check if clicking inside any rectangle to start dragging
canvas.addEventListener('mousedown', (e) =&gt; {
  const rect = canvas.getBoundingClientRect();
  const mouseX = e.clientX - rect.left;
  const mouseY = e.clientY - rect.top;

  for (let i = 0; i &lt; rectangles.length; i++) {
    if (isInsideRect(mouseX, mouseY, rectangles[i])) {
      isDragging = true;
      dragIndex = i;
      offsetX = mouseX - rectangles[i].x;
      offsetY = mouseY - rectangles[i].y;
      break;
    }
  }
});

// Mouse move: If dragging, update rectangle position and redraw
canvas.addEventListener('mousemove', (e) =&gt; {
  if (!isDragging) return;

  const rect = canvas.getBoundingClientRect();
  const mouseX = e.clientX - rect.left;
  const mouseY = e.clientY - rect.top;

  rectangles[dragIndex].x = mouseX - offsetX;
  rectangles[dragIndex].y = mouseY - offsetY;

  draw();
});

// Mouse up: Stop dragging
canvas.addEventListener('mouseup', () =&gt; {
  isDragging = false;
  dragIndex = null;
});

// Mouse leave: Cancel dragging if mouse leaves canvas
canvas.addEventListener('mouseout', () =&gt; {
  isDragging = false;
  dragIndex = null;
});
&lt;/script&gt;

&lt;/body&gt;
&lt;/html&gt;</textarea> <br> <button onclick="renderIframe(this,'SBQkG','fVIcf')">Run</button>
  <div id="fVIcf_FloatingLog" class="floatingLog" aria-live="polite" role="alert"></div> <iframe id="fVIcf" class="result_iframe" style="display: none;"></iframe>
  <script>
			{
				let editor = CodeMirror.fromTextArea(document
						.getElementById("SBQkG"), {
					mode : "htmlmixed",
					lineNumbers : false,
					tabSize : 2
				});
			    const mode = localStorage.getItem("mode") || "light";  
			    const newTheme = mode === "dark" ? "material" : "default";
			    editor.setOption("theme", newTheme);
			    
				codeMirrorMap.set("SBQkG", editor);

				let editor1 = CodeMirror.fromTextArea(document.getElementById("SBQkG_Textarea"), {
					mode : "htmlmixed",
					lineNumbers : false,
					tabSize : 2
				});
			    editor1.setOption("theme", newTheme);				
				
				codeMirrorMap.set("SBQkG_Textarea", editor1);
			}
		    function openDialog(id) {
		        closeAll();
		        document.getElementById(id).style.display = 'flex';
		        setTimeout(() => {
		        	 codeMirrorMap.get("SBQkG_Textarea").refresh();
		        }, 100); // 100ms 
		      }

		      function closeAll() {
		        document.querySelectorAll('.dialog-backdrop').forEach(el => {
		          el.style.display = 'none';
		        });
		      }			
		</script>
 </div>
</div><h3 id="how-this-works">How This Works</h3><ul>
 <li>When the user presses the mouse down (<code>mousedown</code>), we check if the mouse is inside any rectangle using <code>isInsideRect()</code>.</li>
 <li>If a rectangle is selected, we store the index and the offset of the mouse from the rectangle’s top-left corner.</li>
 <li>On <code>mousemove</code>, if dragging, the rectangle’s position is updated based on the current mouse position minus the offset to keep the drag smooth.</li>
 <li>The canvas is cleared and redrawn after every move to show the updated position.</li>
 <li>Dragging stops on <code>mouseup</code> or when the mouse leaves the canvas.</li>
</ul><h3 id="enhancements-to-consider">Enhancements to Consider</h3><ul>
 <li><strong>Snapping to Grid:</strong> Snap dragged objects to fixed grid points by rounding positions.</li>
 <li><strong>Bounding Constraints:</strong> Prevent shapes from being dragged outside the canvas edges.</li>
 <li><strong>Multiple Shapes &amp; Selection:</strong> Add selection outlines, multi-select, or layering.</li>
 <li><strong>Dragging Other Shapes:</strong> Extend hit detection for circles, polygons, or complex shapes using geometric math or libraries.</li>
</ul><h3 id="summary">Summary</h3><p>Drag-and-drop on canvas involves:</p><ul>
 <li>Detecting if clicks occur inside shapes (hit detection).</li>
 <li>Tracking mouse movement to update positions.</li>
 <li>Redrawing the canvas to reflect changes in real time.</li>
</ul><p>This functionality lays the foundation for interactive editors, games, and custom UI components. Next, we’ll explore combining these techniques into a practical drawing and editing tool.</p><div class = "chapter-navi-section">
<a href="#top" class="nav-button prev">↑</a>
<a href='javascript-canvas-programming.htm#user-interaction-and-event-handling' class="nav-button toc-link">Index</a>
<a href="#bottom" class="nav-button next">↓</a>
</div>
<h2 id='practical-example-drawing-and-editing-with-mouse'>9.4 Practical Example: Drawing and Editing with Mouse</h2><p>In this section, we combine the concepts from previous lessons to create a <strong>simple interactive canvas tool</strong> that allows users to:</p><ul>
 <li>Draw rectangles by clicking and dragging,</li>
 <li>Select and move existing rectangles,</li>
 <li>Delete selected rectangles with a keyboard key.</li>
</ul><p>This example emphasizes modular code design—separating event handling, shape management, and rendering—making it easier to extend or customize later.</p><h3 id="features-overview">Features Overview</h3><ul>
 <li><strong>Drawing mode:</strong> Click and drag to create new rectangles.</li>
 <li><strong>Select mode:</strong> Click a shape to select it; drag to move it.</li>
 <li><strong>Delete:</strong> Press the <code>Delete</code> or <code>Backspace</code> key to remove the selected shape.</li>
 <li><strong>Visual feedback:</strong> Highlight the selected shape.</li>
 <li><strong>Simple toolbar:</strong> Toggle between draw and select modes.</li>
</ul><h3 id="html-structure">HTML Structure</h3><div class="code-block"><button class="copy-button" onclick="copyCode(this)">▯</button>
 <pre><code class="language-html">&lt;div&gt;
  &lt;button id="drawBtn"&gt;Draw&lt;/button&gt;
  &lt;button id="selectBtn"&gt;Select&lt;/button&gt;
&lt;/div&gt;
&lt;canvas id="canvas" width="700" height="400" style="border:1px solid #ccc;"&gt;&lt;/canvas&gt;</code></pre>
</div><h3 id="javascript-code">JavaScript Code</h3><div class="code-block"><button class="copy-button" onclick="copyCode(this)">▯</button>
 <pre><code class="language-js">const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');

const drawBtn = document.getElementById('drawBtn');
const selectBtn = document.getElementById('selectBtn');

let mode = 'draw'; // Current mode: 'draw' or 'select'
let shapes = [];   // Array to store rectangles
let selectedShapeIndex = null;

let isDrawing = false;
let startX = 0;
let startY = 0;

let isDragging = false;
let dragOffsetX = 0;
let dragOffsetY = 0;

// Utility: Check if a point is inside a rectangle
function isInsideRect(x, y, rect) {
  return x &gt;= rect.x &amp;&amp;
         x &lt;= rect.x + rect.width &amp;&amp;
         y &gt;= rect.y &amp;&amp;
         y &lt;= rect.y + rect.height;
}

// Draw all shapes, highlighting selected one
function draw() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  
  shapes.forEach((rect, i) =&gt; {
    ctx.fillStyle = rect.color;
    ctx.fillRect(rect.x, rect.y, rect.width, rect.height);
    
    if (i === selectedShapeIndex) {
      ctx.strokeStyle = 'orange';
      ctx.lineWidth = 3;
      ctx.strokeRect(rect.x, rect.y, rect.width, rect.height);
    }
  });
}

// Set current mode and update button styles
function setMode(newMode) {
  mode = newMode;
  drawBtn.disabled = (mode === 'draw');
  selectBtn.disabled = (mode === 'select');
  selectedShapeIndex = null;
  draw();
}

drawBtn.addEventListener('click', () =&gt; setMode('draw'));
selectBtn.addEventListener('click', () =&gt; setMode('select'));

// Mouse down event handler
canvas.addEventListener('mousedown', (e) =&gt; {
  const rect = canvas.getBoundingClientRect();
  const mouseX = e.clientX - rect.left;
  const mouseY = e.clientY - rect.top;

  if (mode === 'draw') {
    // Start drawing new rectangle
    isDrawing = true;
    startX = mouseX;
    startY = mouseY;
  } else if (mode === 'select') {
    // Check if clicking on any existing shape (top-down)
    selectedShapeIndex = null;
    for (let i = shapes.length - 1; i &gt;= 0; i--) {
      if (isInsideRect(mouseX, mouseY, shapes[i])) {
        selectedShapeIndex = i;
        dragOffsetX = mouseX - shapes[i].x;
        dragOffsetY = mouseY - shapes[i].y;
        isDragging = true;
        break;
      }
    }
    draw();
  }
});

// Mouse move event handler
canvas.addEventListener('mousemove', (e) =&gt; {
  if (mode === 'draw' &amp;&amp; isDrawing) {
    const rect = canvas.getBoundingClientRect();
    const mouseX = e.clientX - rect.left;
    const mouseY = e.clientY - rect.top;

    // Draw a preview rectangle (clear and redraw all)
    draw();
    ctx.strokeStyle = 'black';
    ctx.lineWidth = 1;
    ctx.strokeRect(startX, startY, mouseX - startX, mouseY - startY);
  } else if (mode === 'select' &amp;&amp; isDragging &amp;&amp; selectedShapeIndex !== null) {
    const rect = canvas.getBoundingClientRect();
    const mouseX = e.clientX - rect.left;
    const mouseY = e.clientY - rect.top;

    // Move the selected shape
    shapes[selectedShapeIndex].x = mouseX - dragOffsetX;
    shapes[selectedShapeIndex].y = mouseY - dragOffsetY;
    draw();
  }
});

// Mouse up event handler
canvas.addEventListener('mouseup', (e) =&gt; {
  if (mode === 'draw' &amp;&amp; isDrawing) {
    const rect = canvas.getBoundingClientRect();
    const mouseX = e.clientX - rect.left;
    const mouseY = e.clientY - rect.top;

    // Create new rectangle and add to shapes array
    const newRect = {
      x: Math.min(startX, mouseX),
      y: Math.min(startY, mouseY),
      width: Math.abs(mouseX - startX),
      height: Math.abs(mouseY - startY),
      color: 'skyblue'
    };
    
    // Only add if rectangle has size
    if (newRect.width &gt; 5 &amp;&amp; newRect.height &gt; 5) {
      shapes.push(newRect);
    }
    isDrawing = false;
    draw();
  } else if (mode === 'select' &amp;&amp; isDragging) {
    isDragging = false;
  }
});

// Keyboard event for deleting selected shape
window.addEventListener('keydown', (e) =&gt; {
  if ((e.key === 'Delete' || e.key === 'Backspace') &amp;&amp; selectedShapeIndex !== null) {
    shapes.splice(selectedShapeIndex, 1);
    selectedShapeIndex = null;
    draw();
  }
});

// Initialize buttons and drawing
setMode('draw');
draw();</code></pre>
</div><div class="snippet-container" id="Uhnpb">
 <div id="n7MQ1_Dialog" class="dialog-backdrop">
  <div class="dialog">
   <h2>Dialog 1</h2>
   <div class="controls"><button onclick="renderIframe(this,'L0K68_Textarea','n7MQ1_IFrame')">Run</button> <button onclick="closeAll()">Close</button>
   </div>
   <div class="dialog-content"><textarea id="L0K68_Textarea" class="textarea_dialog" placeholder="Type HTML here...">&lt;!DOCTYPE html&gt;
&lt;html lang="en"&gt;
&lt;head&gt;
  &lt;meta charset="UTF-8" /&gt;
  &lt;title&gt;Canvas Draw and Select&lt;/title&gt;
  &lt;style&gt;
    body {
      font-family: sans-serif;
      padding: 1rem;
    }
    canvas {
      margin-top: 1rem;
      border: 1px solid #ccc;
      display: block;
    }
    button {
      margin-right: 10px;
    }
  &lt;/style&gt;
&lt;/head&gt;
&lt;body&gt;

&lt;h3&gt;Canvas: Draw &amp; Select Rectangles&lt;/h3&gt;

&lt;div&gt;
  &lt;button id="drawBtn"&gt;Draw&lt;/button&gt;
  &lt;button id="selectBtn"&gt;Select&lt;/button&gt;
&lt;/div&gt;

&lt;canvas id="canvas" width="700" height="400"&gt;&lt;/canvas&gt;

&lt;script&gt;
  const canvas = document.getElementById('canvas');
  const ctx = canvas.getContext('2d');

  const drawBtn = document.getElementById('drawBtn');
  const selectBtn = document.getElementById('selectBtn');

  let mode = 'draw';
  let shapes = [];
  let selectedShapeIndex = null;

  let isDrawing = false;
  let startX = 0;
  let startY = 0;

  let isDragging = false;
  let dragOffsetX = 0;
  let dragOffsetY = 0;

  function isInsideRect(x, y, rect) {
    return x &gt;= rect.x &amp;&amp;
           x &lt;= rect.x + rect.width &amp;&amp;
           y &gt;= rect.y &amp;&amp;
           y &lt;= rect.y + rect.height;
  }

  function draw() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);

    shapes.forEach((rect, i) =&gt; {
      ctx.fillStyle = rect.color;
      ctx.fillRect(rect.x, rect.y, rect.width, rect.height);

      if (i === selectedShapeIndex) {
        ctx.strokeStyle = 'orange';
        ctx.lineWidth = 3;
        ctx.strokeRect(rect.x, rect.y, rect.width, rect.height);
      }
    });
  }

  function setMode(newMode) {
    mode = newMode;
    drawBtn.disabled = (mode === 'draw');
    selectBtn.disabled = (mode === 'select');
    selectedShapeIndex = null;
    draw();
  }

  drawBtn.addEventListener('click', () =&gt; setMode('draw'));
  selectBtn.addEventListener('click', () =&gt; setMode('select'));

  canvas.addEventListener('mousedown', (e) =&gt; {
    const rect = canvas.getBoundingClientRect();
    const mouseX = e.clientX - rect.left;
    const mouseY = e.clientY - rect.top;

    if (mode === 'draw') {
      isDrawing = true;
      startX = mouseX;
      startY = mouseY;
    } else if (mode === 'select') {
      selectedShapeIndex = null;
      for (let i = shapes.length - 1; i &gt;= 0; i--) {
        if (isInsideRect(mouseX, mouseY, shapes[i])) {
          selectedShapeIndex = i;
          dragOffsetX = mouseX - shapes[i].x;
          dragOffsetY = mouseY - shapes[i].y;
          isDragging = true;
          break;
        }
      }
      draw();
    }
  });

  canvas.addEventListener('mousemove', (e) =&gt; {
    const rect = canvas.getBoundingClientRect();
    const mouseX = e.clientX - rect.left;
    const mouseY = e.clientY - rect.top;

    if (mode === 'draw' &amp;&amp; isDrawing) {
      draw();
      ctx.strokeStyle = 'black';
      ctx.lineWidth = 1;
      ctx.strokeRect(startX, startY, mouseX - startX, mouseY - startY);
    } else if (mode === 'select' &amp;&amp; isDragging &amp;&amp; selectedShapeIndex !== null) {
      shapes[selectedShapeIndex].x = mouseX - dragOffsetX;
      shapes[selectedShapeIndex].y = mouseY - dragOffsetY;
      draw();
    }
  });

  canvas.addEventListener('mouseup', (e) =&gt; {
    const rect = canvas.getBoundingClientRect();
    const mouseX = e.clientX - rect.left;
    const mouseY = e.clientY - rect.top;

    if (mode === 'draw' &amp;&amp; isDrawing) {
      const newRect = {
        x: Math.min(startX, mouseX),
        y: Math.min(startY, mouseY),
        width: Math.abs(mouseX - startX),
        height: Math.abs(mouseY - startY),
        color: 'skyblue'
      };
      if (newRect.width &gt; 5 &amp;&amp; newRect.height &gt; 5) {
        shapes.push(newRect);
      }
      isDrawing = false;
      draw();
    } else if (mode === 'select' &amp;&amp; isDragging) {
      isDragging = false;
    }
  });

  window.addEventListener('keydown', (e) =&gt; {
    if ((e.key === 'Delete' || e.key === 'Backspace') &amp;&amp; selectedShapeIndex !== null) {
      shapes.splice(selectedShapeIndex, 1);
      selectedShapeIndex = null;
      draw();
    }
  });

  setMode('draw');
  draw();
&lt;/script&gt;

&lt;/body&gt;
&lt;/html&gt;</textarea> <iframe id="n7MQ1_IFrame" class="iframe_dialog"></iframe>
   </div>
  </div>
 </div>
 <div class="snippet-header" onclick="toggleSnippetAndRefresh('Uhnpb','L0K68')">
  Click to Try it <!--<span onclick="toggleSnippetAndRefresh('Uhnpb','L0K68')">Click
			to Try it</span> --> <!-- <span onclick="openDialog('n7MQ1_Dialog')">Dialog</span> -->
 </div>
 <div class="snippet-body"><textarea id="L0K68">&lt;!DOCTYPE html&gt;
&lt;html lang="en"&gt;
&lt;head&gt;
  &lt;meta charset="UTF-8" /&gt;
  &lt;title&gt;Canvas Draw and Select&lt;/title&gt;
  &lt;style&gt;
    body {
      font-family: sans-serif;
      padding: 1rem;
    }
    canvas {
      margin-top: 1rem;
      border: 1px solid #ccc;
      display: block;
    }
    button {
      margin-right: 10px;
    }
  &lt;/style&gt;
&lt;/head&gt;
&lt;body&gt;

&lt;h3&gt;Canvas: Draw &amp; Select Rectangles&lt;/h3&gt;

&lt;div&gt;
  &lt;button id="drawBtn"&gt;Draw&lt;/button&gt;
  &lt;button id="selectBtn"&gt;Select&lt;/button&gt;
&lt;/div&gt;

&lt;canvas id="canvas" width="700" height="400"&gt;&lt;/canvas&gt;

&lt;script&gt;
  const canvas = document.getElementById('canvas');
  const ctx = canvas.getContext('2d');

  const drawBtn = document.getElementById('drawBtn');
  const selectBtn = document.getElementById('selectBtn');

  let mode = 'draw';
  let shapes = [];
  let selectedShapeIndex = null;

  let isDrawing = false;
  let startX = 0;
  let startY = 0;

  let isDragging = false;
  let dragOffsetX = 0;
  let dragOffsetY = 0;

  function isInsideRect(x, y, rect) {
    return x &gt;= rect.x &amp;&amp;
           x &lt;= rect.x + rect.width &amp;&amp;
           y &gt;= rect.y &amp;&amp;
           y &lt;= rect.y + rect.height;
  }

  function draw() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);

    shapes.forEach((rect, i) =&gt; {
      ctx.fillStyle = rect.color;
      ctx.fillRect(rect.x, rect.y, rect.width, rect.height);

      if (i === selectedShapeIndex) {
        ctx.strokeStyle = 'orange';
        ctx.lineWidth = 3;
        ctx.strokeRect(rect.x, rect.y, rect.width, rect.height);
      }
    });
  }

  function setMode(newMode) {
    mode = newMode;
    drawBtn.disabled = (mode === 'draw');
    selectBtn.disabled = (mode === 'select');
    selectedShapeIndex = null;
    draw();
  }

  drawBtn.addEventListener('click', () =&gt; setMode('draw'));
  selectBtn.addEventListener('click', () =&gt; setMode('select'));

  canvas.addEventListener('mousedown', (e) =&gt; {
    const rect = canvas.getBoundingClientRect();
    const mouseX = e.clientX - rect.left;
    const mouseY = e.clientY - rect.top;

    if (mode === 'draw') {
      isDrawing = true;
      startX = mouseX;
      startY = mouseY;
    } else if (mode === 'select') {
      selectedShapeIndex = null;
      for (let i = shapes.length - 1; i &gt;= 0; i--) {
        if (isInsideRect(mouseX, mouseY, shapes[i])) {
          selectedShapeIndex = i;
          dragOffsetX = mouseX - shapes[i].x;
          dragOffsetY = mouseY - shapes[i].y;
          isDragging = true;
          break;
        }
      }
      draw();
    }
  });

  canvas.addEventListener('mousemove', (e) =&gt; {
    const rect = canvas.getBoundingClientRect();
    const mouseX = e.clientX - rect.left;
    const mouseY = e.clientY - rect.top;

    if (mode === 'draw' &amp;&amp; isDrawing) {
      draw();
      ctx.strokeStyle = 'black';
      ctx.lineWidth = 1;
      ctx.strokeRect(startX, startY, mouseX - startX, mouseY - startY);
    } else if (mode === 'select' &amp;&amp; isDragging &amp;&amp; selectedShapeIndex !== null) {
      shapes[selectedShapeIndex].x = mouseX - dragOffsetX;
      shapes[selectedShapeIndex].y = mouseY - dragOffsetY;
      draw();
    }
  });

  canvas.addEventListener('mouseup', (e) =&gt; {
    const rect = canvas.getBoundingClientRect();
    const mouseX = e.clientX - rect.left;
    const mouseY = e.clientY - rect.top;

    if (mode === 'draw' &amp;&amp; isDrawing) {
      const newRect = {
        x: Math.min(startX, mouseX),
        y: Math.min(startY, mouseY),
        width: Math.abs(mouseX - startX),
        height: Math.abs(mouseY - startY),
        color: 'skyblue'
      };
      if (newRect.width &gt; 5 &amp;&amp; newRect.height &gt; 5) {
        shapes.push(newRect);
      }
      isDrawing = false;
      draw();
    } else if (mode === 'select' &amp;&amp; isDragging) {
      isDragging = false;
    }
  });

  window.addEventListener('keydown', (e) =&gt; {
    if ((e.key === 'Delete' || e.key === 'Backspace') &amp;&amp; selectedShapeIndex !== null) {
      shapes.splice(selectedShapeIndex, 1);
      selectedShapeIndex = null;
      draw();
    }
  });

  setMode('draw');
  draw();
&lt;/script&gt;

&lt;/body&gt;
&lt;/html&gt;</textarea> <br> <button onclick="renderIframe(this,'L0K68','n7MQ1')">Run</button>
  <div id="n7MQ1_FloatingLog" class="floatingLog" aria-live="polite" role="alert"></div> <iframe id="n7MQ1" class="result_iframe" style="display: none;"></iframe>
  <script>
			{
				let editor = CodeMirror.fromTextArea(document
						.getElementById("L0K68"), {
					mode : "htmlmixed",
					lineNumbers : false,
					tabSize : 2
				});
			    const mode = localStorage.getItem("mode") || "light";  
			    const newTheme = mode === "dark" ? "material" : "default";
			    editor.setOption("theme", newTheme);
			    
				codeMirrorMap.set("L0K68", editor);

				let editor1 = CodeMirror.fromTextArea(document.getElementById("L0K68_Textarea"), {
					mode : "htmlmixed",
					lineNumbers : false,
					tabSize : 2
				});
			    editor1.setOption("theme", newTheme);				
				
				codeMirrorMap.set("L0K68_Textarea", editor1);
			}
		    function openDialog(id) {
		        closeAll();
		        document.getElementById(id).style.display = 'flex';
		        setTimeout(() => {
		        	 codeMirrorMap.get("L0K68_Textarea").refresh();
		        }, 100); // 100ms 
		      }

		      function closeAll() {
		        document.querySelectorAll('.dialog-backdrop').forEach(el => {
		          el.style.display = 'none';
		        });
		      }			
		</script>
 </div>
</div><h3 id="explanation">Explanation</h3><ul>
 <li><strong>Mode management:</strong> Two modes (<code>draw</code> and <code>select</code>) toggle what mouse actions do.</li>
 <li><strong>Drawing:</strong> In draw mode, users click and drag to create new rectangles, with a preview shown during drag.</li>
 <li><strong>Selecting and dragging:</strong> In select mode, clicking a rectangle highlights it; dragging moves it smoothly.</li>
 <li><strong>Deleting:</strong> The keyboard’s Delete or Backspace key removes the selected shape.</li>
 <li><strong>Rendering:</strong> The <code>draw()</code> function clears and redraws all shapes each frame, highlighting the selected one with an orange outline.</li>
 <li><strong>Modularity:</strong> Event listeners are cleanly organized for different interaction states.</li>
</ul><h3 id="ideas-for-further-improvement">Ideas for Further Improvement</h3><ul>
 <li>Add color pickers to change the fill color of shapes.</li>
 <li>Support resizing of shapes with drag handles.</li>
 <li>Implement undo/redo stacks for editing history.</li>
 <li>Add more shape types (circles, polygons).</li>
 <li>Save/load drawings using JSON or images.</li>
</ul><h3 id="summary">Summary</h3><p>This practical example demonstrates how to build a versatile, interactive canvas app that supports:</p><ul>
 <li>Drawing new shapes,</li>
 <li>Selecting and moving existing shapes,</li>
 <li>Deleting shapes using keyboard input,</li>
 <li>Clean state management for intuitive user experience.</li>
</ul><p>By combining drawing, event handling, and stateful shape management, you’re well on your way to creating powerful graphical applications!</p><div class = "chapter-navi-section">
<a href="javascript-canvas-programming-advanced-animation-techniques.htm" class="nav-button prev">←</a>
<a href='javascript-canvas-programming.htm#user-interaction-and-event-handling' class="nav-button toc-link">Index</a>
<a href="javascript-canvas-programming-working-with-canvas-state-and-compositing.htm" class="nav-button next">→</a>
</div>
<section class="download-section">
  <div class="book-cover" style="background-color: #f9f6f1;border: 1px solid #ccc;"> 
    <div class="book-cover-title" style="font-size: 16px;color: #333;top: 10px;">JavaScript Canvas Programming</div>
    <div class="book-cover-author">readbytes</div>
    <div class="book-cover-bottom-stripe" style="background-color: #333;"></div>
    <img class="book-cover-icon" style="width: 80px;height: 80px;top: 70px;" src='data:image/png;base64,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'/>
  </div>
  <div class="download-info">
    <h2 id='bottom'>Download This Ebook</h2>
    <p class="format-label">Available formats:</p>
    <div class="download-buttons">
      <a href="javascript-canvas-programming.pdf" class="download-button">📄 PDF</a>
      <a href="javascript-canvas-programming.epub" class="download-button">📘 EPUB</a>
    </div>
  </div>
</section><div class='related-books'>
<h2>Javascript Web Front Books</h2>
<div class='related-book-list'>
<a href="javascript-canvas-programming.htm">
<div class="book-cover" style="background-color: #f9f6f1;border: 1px solid #ccc;"> 
    <div class="book-cover-title" style="font-size: 16px;color: #333;top: 10px;">JavaScript Canvas Programming</div>
    <div class="book-cover-author">readbytes</div>
    <div class="book-cover-bottom-stripe" style="background-color: #333;"></div>
    <img class="book-cover-icon" style="width: 80px;height: 80px;top: 70px;" src='data:image/png;base64,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'/>
  </div>
</a>


<a href="javascript-dom-programming.htm">
<div class="book-cover" style="background-color: #f9f6f1;border: 1px solid #ccc;"> 
    <div class="book-cover-title" style="font-size: 16px;color: #333;top: 20px;">JavaScript DOM Programming</div>
    <div class="book-cover-author">readbytes</div>
    <div class="book-cover-bottom-stripe" style="background-color: #333;"></div>
    <img class="book-cover-icon" style="width: 90px;height: 90px;top: 60px;" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAFoAAABaCAYAAAA4qEECAAADUklEQVR4Xu2dv47TQBDGI0RDczY9rwMlrwEFBweC/t4EXRwaXuI6WiSaOLkCIZ6BCqTgPRFr8zkbnPF4Zuydn/RVuzsz33eSlX/2LRYRm1Xxe1MVOzY19eL6/6NzfqCw/ilEvXc2Mwh7pNiuyks8O1T1snyNfVLgWQ5hjxbcyCHskaJelVd4drCW5Vvsk6JzlkHYo6XXph5Q6hwEfUZASDhLqUOZ+Ri96vTa1ANKHQ+aAKWOB02AUseDJkCp40EToNTxoAlQ6njQBCh1PGgClDrZBs0l7JEi23eGXMIeKTbVxSs8O1Trm4tL7JMCz3IIe7Rsq+IXbh6iUA97nALPDxXWP4W29w5xMVwbG67rOBVR76LNAA9aiKyCbq49L0QbRmgGHXuul8VLXB+F3IPGtdGIm0o21gpay+89Gs01gtbwecDPz08eSQ8hHTT6C55xjwh3q+IZDhO0u148wL0cSAR93cyOfoKCV9wryu528RCHmpuCR/StRvOy7w8OOHUFT+jTDHdV+RwHnpqCB/SVFRLXaGfhQYvhQQvhQQvhQQvhQf8DXyZNXehPnW+fisc45FwUvKFfNXC4uQn9qvD1Y1maG4qB2NP3xiOui1NX5Zv9QNuq+IDrU6Xx8n7vq16WV7guTvxKYH1TvsP1qWLOl7mBmDDny9xATJjzZW4gJsz5MjcQE+Z8mRuICXO+zA3EhDlf5gZiwpwvcwMxYc6XuYGYMOfL3EBMmPNlbiAmzPkyNxAT5nyZG4gJc778Y1Ih/IN/QeKh5ij0q8acv5z9YenL2T045NSF/rIhfiWQ9Q9oxsaDFsKDFsKDFsKDFsKDjqj9ZqFx8dvfRubWb+gcn+Yv/hSHuh9swrcoh9nRT5DaLcpf/KZ7GXAIXB8D6aADGj5btJprBB3Q8nvQGNfGRCvogLjntT+8SubhVVohBzSDDoh6F20GeNBCzCZo7Qeh4vmhwvqnEPWOmzmEPVJk9Vhj3Mgh7JHi4LLApTMuL52zDMIeLb029YBSh+v6G85S6lBmPkavOr029YBSx4MmQKnjQROg1PGgCVDqeNAEKHU8aAKUOh40AUodD5oApU62QXMJe6TI9p0hl7BHitz+XTX3j2DO+gHKkfODhPVPsRnZ+1+tJg8Iaaje6wAAAABJRU5ErkJggg=="/>
  </div>
</a>


<a href="javascript-data-visualization.htm">
<div class="book-cover" style="background-color: #f9f6f1;border: 1px solid #ccc;"> 
    <div class="book-cover-title" style="font-size: 16px;color: #333;top: 20px;">JavaScript Data Visualization</div>
    <div class="book-cover-author">readbytes</div>
    <div class="book-cover-bottom-stripe" style="background-color: #333;"></div>
    <img class="book-cover-icon" style="width: 90px;height: 90px;top: 60px;" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAFoAAABaCAYAAAA4qEECAAAC0UlEQVR4Xu3dMWsUURSG4fwr2U6zJI0WKZSAaa0EG7tU2giWimLETrQQQRCxUDsbK3+IYOWCiFU06IQz356ZuffOvXdm4A28ze585OxDsLDZnR3zs1pf+rHavXhKWdpY2/Mf50HKEMgV+4cs/1z8/v6OMiTYm9Zfsz5M42r9VQNdLqArBXSlgK4U0JUCulKLgrb39aW7ObQY6PXl/S3Qrs6e1f3ULQZaMYfS/dTZ2xYDvff6g9tS7ge6YEBXCuhKAV0poCsFdKWArtQk0G9e3Tt9dnLc2+dPD1sboCOzv2Ool8/vujsFBtpJMYfydgoMtFMqWOpuLtnbgC6YvQ3ogtnbgC6YvQ3ogtnbgC6YvQ3ogtnbgC6YvQ3ogtnboqCvHR20xn11/UKF6gNL3Y1JP0dXV68fbG01+3wUtP6yvp4+OXZ3CtUHlrpL7ew/tvRz9KV7zT4LtGmW0O+/fnRr3l86tH4u/Xwhv88+C7QJ6MhdakBH7lIDOnKXGtCRu9SAjtylBnTkLjWgI3e67evnt7fnG6BH7EJqdkCP2IXU7IAesft169DN2wE9YqfAQDt35NgpMNDOHTl2Cgy0c0eOnQID7dxhXwvJ2ykw0M4d9rWQvJ0CA+3cYV8LydspMNDOHfa1C/cfuQ3tFBho5w77mgID/f99oCeGDsnbKXBp6JDUR7PPAm12QO8CvVXzfhe0QoWC6fOhOwUOhX7w4rGbt+vKPgu02QE9YqfAi4Meai7QITU7oEfsQmp2s4S+cfumW/P+XKDvXFm7ebtZQusBeshcoL8c7rt5O6BH7BQYaOeOHDsFBtq5I8dOgYF27sixU2CgnTty7BQYaOeOHDsFBtq5I8dOgRcHPVQXdEhT7Wb536RDAQ30Vs1uNtAUF9CVArpSQFcK6EoBXSmgK9WG5qtQi2RNV803KsuLlDn7RcpgF6qF3Pz8fWOjD1JyrS9g/wOlHj3Oru4PcQAAAABJRU5ErkJggg=="/>
  </div>
</a>


<a href="jquery-in-depth.htm">
<div class="book-cover" style="background-color: #f9f6f1;border: 1px solid #ccc;"> 
    <div class="book-cover-title" style="font-size: 18px;color: #333;top: 20px;">jQuery In-Depth</div>
    <div class="book-cover-author">readbytes</div>
    <div class="book-cover-bottom-stripe" style="background-color: #333;"></div>
    <img class="book-cover-icon" style="width: 90px;height: 90px;top: 65px;" src='data:image/png;base64,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'/>
  </div>
</a>



<a href='javascript.htm'><div class='book-cover' style='background-color: #f9f6f1;color: #111111;border: 1px solid #ccc;display: flex;justify-content: center;align-items: center;text-align: center;'>More Javascript Books</div></a>
</div>
</div>
  </div>
  <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/prism.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
  
  <script>
    function copyCode(button) {
      const code = button.nextElementSibling.innerText;
      navigator.clipboard.writeText(code).then(() => {
        button.textContent = 'Copied!';
        setTimeout(() => { button.textContent = 'Copy'; }, 1500);
      });
    }
  </script>  
<div id="floatingLog" aria-live="polite" role="alert"></div>
<footer class="page-footer">
    <nav>
      <a href="https://readbytes.github.io">Home</a> | 
      Email:<script language="JavaScript" type="text/javascript">
var part1 = 'yinpeng';var part6 = '263';var part2 = Math.pow(2,6);var part3 = String.fromCharCode(part2);var part4 = 'hotmail dot com';var part5 = part1 + String.fromCharCode(part2) + part4;document.write(part1 + part6 + part3 + part4);
</script>
    </nav>
  <p>© 2025 — All rights reserved.</p>    
  </footer>

</body>
</html>